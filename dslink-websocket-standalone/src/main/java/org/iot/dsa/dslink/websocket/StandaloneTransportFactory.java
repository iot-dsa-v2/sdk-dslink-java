package org.iot.dsa.dslink.websocket;

import com.acuity.iot.dsa.dslink.DSTransport;
import com.acuity.iot.dsa.dslink.DSTransport.Factory;
import org.iot.dsa.logging.DSLogger;
import org.iot.dsa.node.DSMap;

/**
 * Websocket client implementation of DSTransport based on Tyrus, the reference
 * implementation of JSR 356.
 *
 * @author Aaron Hansen
 */
public class StandaloneTransportFactory extends DSLogger implements Factory {

    ///////////////////////////////////////////////////////////////////////////
    // Constants
    ///////////////////////////////////////////////////////////////////////////

    ///////////////////////////////////////////////////////////////////////////
    // Fields
    ///////////////////////////////////////////////////////////////////////////

    /////////////////////////////////////////////////////////////////
    // Methods - Constructors
    /////////////////////////////////////////////////////////////////

    /////////////////////////////////////////////////////////////////
    // Methods - In alphabetical order by method name.
    /////////////////////////////////////////////////////////////////

    @Override
    public DSTransport makeTransport(DSMap connectionInitResponse) {
        String wsUri = connectionInitResponse.get("wsUri", null);
        if (wsUri == null) {
            throw new IllegalStateException("Only websocket transports are supported.");
        }
        if (!"json".equals(connectionInitResponse.getString("format"))) {
            throw new IllegalStateException("Only json is supported.");
        }
        return new TextWsTransport();
    }

    /////////////////////////////////////////////////////////////////
    // Inner Classes
    /////////////////////////////////////////////////////////////////

    /////////////////////////////////////////////////////////////////
    // Initialization
    /////////////////////////////////////////////////////////////////

}//TyrusTransportFactory
